#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸ—º 2ë‹¨ê³„: ì§€ë„ ì‹œê°í™”
===========================================

ì´ íŒŒì¼ì€ ë¶„ì„ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§€ì—­ ì§€ë„ë¥¼ ì‹œê°í™”í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

ğŸ“ ì…ë ¥:
- 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ë¶„ì„ ë°ì´í„° (area1_analyzed_data.csv ë˜ëŠ” caffee_map.py)

ğŸ“Š ì¶œë ¥:
- map.png: ì‹œê°í™”ëœ ì§€ë„ ì´ë¯¸ì§€

ğŸ¨ ì‹œê°í™” ê·œì¹™:
- ì¢Œì¸¡ ìƒë‹¨ì´ (1,1), ìš°ì¸¡ í•˜ë‹¨ì´ ê°€ì¥ í° ì¢Œí‘œ
- ì•„íŒŒíŠ¸/ë¹Œë”©: ê°ˆìƒ‰ ì›í˜•
- ë°˜ë‹¬ê³° ì»¤í”¼: ë…¹ìƒ‰ ì‚¬ê°í˜•  
- ë‚´ ì§‘: ë…¹ìƒ‰ ì‚¼ê°í˜•
- ê±´ì„¤ í˜„ì¥: íšŒìƒ‰ ì‚¬ê°í˜•
- ê±´ì„¤ í˜„ì¥ì´ ë‹¤ë¥¸ êµ¬ì¡°ë¬¼ê³¼ ê²¹ì¹˜ë©´ ê±´ì„¤ í˜„ì¥ ìš°ì„ 

ğŸ”§ ì£¼ìš” ê¸°ëŠ¥:
1. ë¶„ì„ëœ ë°ì´í„° ë¡œë“œ
2. êµ¬ì¡°ë¬¼ë³„ ì‹œê°í™” ì„¤ì •
3. matplotlibì„ ì‚¬ìš©í•œ ì§€ë„ ê·¸ë¦¬ê¸°
4. ê²©ì ë° ë²”ë¡€ í‘œì‹œ
5. PNG íŒŒì¼ë¡œ ì €ì¥

ì‘ì„±ì: AI Assistant
ë‚ ì§œ: 2024ë…„
"""

import pandas as pd  # ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
import matplotlib.pyplot as plt  # ê·¸ë˜í”„ ê·¸ë¦¬ê¸°ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
plt.rcParams['font.family'] = 'AppleGothic'  # í•œê¸€ í°íŠ¸ ì„¤ì • (Mac)
plt.rcParams['axes.unicode_minus'] = False   # ë§ˆì´ë„ˆìŠ¤ ê¹¨ì§ ë°©ì§€
from typing import Optional, Tuple  # íƒ€ì… íŒíŠ¸ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬


def load_analyzed_data(filename: str) -> Optional[pd.DataFrame]:
    try:
        data = pd.read_csv(filename)
        print(f'âœ… {filename} ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.')
        return data
    except FileNotFoundError:
        print(f'âŒ {filename} íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
        return None
    except Exception as e:
        print(f'âŒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: {e}')
        return None


def create_map_visualization(data: pd.DataFrame, save_path: str = 'map.png') -> None:
    """
    ì§€ë„ë¥¼ ì‹œê°í™”í•˜ëŠ” í•¨ìˆ˜
    
    ì´ í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ê³„ë¡œ ì§€ë„ë¥¼ ê·¸ë¦½ë‹ˆë‹¤:
    1. ì‹œê°í™” ì„¤ì • ì •ì˜
    2. ê·¸ë˜í”„ ì°½ ìƒì„±
    3. ê²©ì ê·¸ë¦¬ê¸°
    4. ê±´ì„¤ í˜„ì¥ ë¨¼ì € ê·¸ë¦¬ê¸°
    5. êµ¬ì¡°ë¬¼ë³„ë¡œ ì‹œê°í™”
    6. ê·¸ë˜í”„ ê¾¸ë¯¸ê¸°
    7. íŒŒì¼ ì €ì¥
    
    Args:
        data: pd.DataFrame - ë¶„ì„ëœ ë°ì´í„°
        save_path: str - ì €ì¥í•  íŒŒì¼ ê²½ë¡œ
    """
    # ============================================
    # 1ë‹¨ê³„: ì‹œê°í™” ì„¤ì • ì •ì˜
    # ============================================
    print('ğŸ¨ ì‹œê°í™” ì„¤ì •ì„ ì •ì˜í•˜ëŠ” ì¤‘...')
    
    # êµ¬ì¡°ë¬¼ë³„ ì‹œê°í™” ì„¤ì •ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ì •ì˜
    # ê° êµ¬ì¡°ë¬¼ë§ˆë‹¤ ìƒ‰ìƒ, ëª¨ì–‘, í¬ê¸°, ë¼ë²¨ì„ ì§€ì •
    visual_config = {
        'Apartment': {
            'color': 'brown',      # ê°ˆìƒ‰
            'marker': 'o',         # ì›í˜• (circle)
            'size': 100,           # í¬ê¸°
            'label': 'ì•„íŒŒíŠ¸/ë¹Œë”©'  # ë²”ë¡€ì— í‘œì‹œë  ì´ë¦„
        },
        'Building': {
            'color': 'brown',      # ê°ˆìƒ‰ (ì•„íŒŒíŠ¸ì™€ ë™ì¼)
            'marker': 'o',         # ì›í˜•
            'size': 100,           # í¬ê¸°
            'label': 'ì•„íŒŒíŠ¸/ë¹Œë”©'  # ë²”ë¡€ì— í‘œì‹œë  ì´ë¦„
        },
        'BandalgomCoffee': {
            'color': 'green',      # ë…¹ìƒ‰
            'marker': 's',         # ì‚¬ê°í˜• (square)
            'size': 120,           # í¬ê¸°
            'label': 'ë°˜ë‹¬ê³° ì»¤í”¼'  # ë²”ë¡€ì— í‘œì‹œë  ì´ë¦„
        },
        'MyHome': {
            'color': 'green',      # ë…¹ìƒ‰
            'marker': '^',         # ì‚¼ê°í˜• (triangle)
            'size': 150,           # í¬ê¸°
            'label': 'ë‚´ ì§‘'       # ë²”ë¡€ì— í‘œì‹œë  ì´ë¦„
        }
    }
    
    # ============================================
    # 2ë‹¨ê³„: ê·¸ë˜í”„ ì°½ ìƒì„±
    # ============================================
    print('ğŸ“ ê·¸ë˜í”„ ì°½ì„ ìƒì„±í•˜ëŠ” ì¤‘...')
    
    # plt.figure(): ìƒˆë¡œìš´ ê·¸ë˜í”„ ì°½ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    # figsize=(12, 10): ì°½ì˜ í¬ê¸°ë¥¼ ê°€ë¡œ 12ì¸ì¹˜, ì„¸ë¡œ 10ì¸ì¹˜ë¡œ ì„¤ì •
    plt.figure(figsize=(12, 10))
    
    # ============================================
    # 3ë‹¨ê³„: ê²©ì ê·¸ë¦¬ê¸°
    # ============================================
    print('ğŸ”² ê²©ìë¥¼ ê·¸ë¦¬ëŠ” ì¤‘...')
    
    # plt.grid(): ê²©ì ì„ ì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
    # True: ê²©ì í‘œì‹œ
    # alpha=0.3: íˆ¬ëª…ë„ 30% (ì„ ì´ ì—°í•˜ê²Œ ë³´ì„)
    # color='gray': ê²©ì ìƒ‰ìƒì„ íšŒìƒ‰ìœ¼ë¡œ ì„¤ì •
    plt.grid(True, alpha=0.3, color='gray')
    
    # ============================================
    # 4ë‹¨ê³„: ê±´ì„¤ í˜„ì¥ ë¨¼ì € ê·¸ë¦¬ê¸° (íšŒìƒ‰ ì‚¬ê°í˜•)
    # ============================================
    print('ğŸ—ï¸ ê±´ì„¤ í˜„ì¥ì„ ê·¸ë¦¬ëŠ” ì¤‘...')
    construction_sites = data[data['ConstructionSite'] == 1]
    construction_coords = set(zip(construction_sites['x'], construction_sites['y']))
    if len(construction_sites) > 0:
        plt.scatter(
            construction_sites['x'],        # x ì¢Œí‘œ
            construction_sites['y'],        # y ì¢Œí‘œ
            c='gray',                       # ìƒ‰ìƒ: íšŒìƒ‰
            marker='s',                     # ëª¨ì–‘: ì‚¬ê°í˜•
            s=80,                           # í¬ê¸°
            label='ê±´ì„¤ í˜„ì¥',              # ë²”ë¡€ ì´ë¦„
            alpha=0.7,                      # íˆ¬ëª…ë„ 70%
            edgecolors='black',             # í…Œë‘ë¦¬ ìƒ‰ìƒ: ê²€ì •
            linewidth=1                     # í…Œë‘ë¦¬ ë‘ê»˜
        )
        print(f'   ê±´ì„¤ í˜„ì¥ {len(construction_sites)}ê°œë¥¼ ê·¸ë ¸ìŠµë‹ˆë‹¤.')
    else:
        print('   ê±´ì„¤ í˜„ì¥ì´ ì—†ìŠµë‹ˆë‹¤.')

    # ============================================
    # 5ë‹¨ê³„: êµ¬ì¡°ë¬¼ë³„ë¡œ ì‹œê°í™”í•˜ê¸° (ê±´ì„¤ í˜„ì¥ê³¼ ê²¹ì¹˜ë©´ ê±´ì„¤ í˜„ì¥ ìš°ì„ )
    # ============================================
    print('ğŸ  êµ¬ì¡°ë¬¼ë“¤ì„ ê·¸ë¦¬ëŠ” ì¤‘...')
    for struct_type in ['Apartment', 'Building', 'BandalgomCoffee', 'MyHome']:
        type_data = data[(data['struct_name'] == struct_type) & (data['category'] != 0)]
        # ê±´ì„¤ í˜„ì¥ê³¼ ê²¹ì¹˜ëŠ” ì¢Œí‘œëŠ” ì œì™¸
        type_data = type_data[~type_data.apply(lambda row: (row['x'], row['y']) in construction_coords, axis=1)]
        if len(type_data) > 0:  # ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ë§Œ
            config = visual_config[struct_type]
            plt.scatter(
                type_data['x'],             # x ì¢Œí‘œ
                type_data['y'],             # y ì¢Œí‘œ
                c=config['color'],          # ìƒ‰ìƒ
                marker=config['marker'],    # ëª¨ì–‘
                s=config['size'],           # í¬ê¸°
                label=config['label'],      # ë²”ë¡€ ì´ë¦„
                alpha=0.8,                  # íˆ¬ëª…ë„ 80%
                edgecolors='black',         # í…Œë‘ë¦¬ ìƒ‰ìƒ
                linewidth=1.5               # í…Œë‘ë¦¬ ë‘ê»˜
            )
            print(f'   {config["label"]} {len(type_data)}ê°œë¥¼ ê·¸ë ¸ìŠµë‹ˆë‹¤.')
        else:
            print(f'   {struct_type}ì´(ê°€) ì—†ìŠµë‹ˆë‹¤.')
    
    # ============================================
    # 6ë‹¨ê³„: ê·¸ë˜í”„ ê¾¸ë¯¸ê¸°
    # ============================================
    print('ğŸ¨ ê·¸ë˜í”„ë¥¼ ê¾¸ë¯¸ëŠ” ì¤‘...')
    
    # ============================================
    # 6-1. ì¢Œí‘œê³„ ì„¤ì •
    # ============================================
    # ë°ì´í„°ì—ì„œ ê°€ì¥ í° x, y ì¢Œí‘œë¥¼ ì°¾ê¸°
    max_x = data['x'].max()
    max_y = data['y'].max()
    
    # ì¢Œí‘œê³„ ì„¤ì • (ì¢Œì¸¡ ìƒë‹¨ì´ (1,1)ì´ ë˜ë„ë¡)
    # plt.xlim(): xì¶• ë²”ìœ„ ì„¤ì •
    # plt.ylim(): yì¶• ë²”ìœ„ ì„¤ì • (yì¶•ì„ ë’¤ì§‘ì–´ì„œ ì¢Œì¸¡ ìƒë‹¨ì´ (1,1)ì´ ë˜ë„ë¡)
    plt.xlim(0, max_x + 1)
    plt.ylim(max_y + 1, 0)  # yì¶• ë’¤ì§‘ê¸°
    
    # ============================================
    # 6-2. ì¶• ë¼ë²¨ ì„¤ì •
    # ============================================
    # plt.xlabel(): xì¶• ë¼ë²¨ ì„¤ì •
    # plt.ylabel(): yì¶• ë¼ë²¨ ì„¤ì •
    plt.xlabel('X ì¢Œí‘œ')
    plt.ylabel('Y ì¢Œí‘œ')
    
    # ============================================
    # 6-3. ì œëª© ì„¤ì •
    # ============================================
    # plt.title(): ê·¸ë˜í”„ ì œëª© ì„¤ì •
    # fontsize=16: ê¸€ì í¬ê¸°
    # fontweight='bold': êµµì€ ê¸€ì”¨
    # ì œëª© ë™ì  ì„¤ì •
    if 'all' in save_path:
        title = 'ì „ì²´ ì§€ì—­ ì§€ë„ ì‹œê°í™”'
    elif 'area1' in save_path or (('area' in data.columns) and (data['area'] == 1).all()):
        title = 'Area 1 ì§€ë„ ì‹œê°í™”'
    else:
        title = 'ì§€ë„ ì‹œê°í™”'
    plt.title(title, fontsize=16, fontweight='bold')
    
    # ============================================
    # 6-4. ë²”ë¡€ í‘œì‹œ
    # ============================================
    # plt.legend(): ë²”ë¡€ í‘œì‹œ
    # loc='upper right': ì˜¤ë¥¸ìª½ ìœ„ì— ìœ„ì¹˜
    # fontsize=10: ê¸€ì í¬ê¸°
    plt.legend(loc='upper right', fontsize=10)
    
    # ============================================
    # 6-5. ê²©ì ë²ˆí˜¸ í‘œì‹œ
    # ============================================
    # plt.xticks(): xì¶• ëˆˆê¸ˆ ì„¤ì •
    # plt.yticks(): yì¶• ëˆˆê¸ˆ ì„¤ì •
    # range(1, max_x + 1, 2): 1ë¶€í„° max_xê¹Œì§€ 2ì”© ì¦ê°€
    plt.xticks(range(1, max_x + 1, 2))
    plt.yticks(range(1, max_y + 1, 2))
    
    # ============================================
    # 7ë‹¨ê³„: ê·¸ë˜í”„ ì €ì¥ ë° í‘œì‹œ
    # ============================================
    print('ğŸ’¾ ê·¸ë˜í”„ë¥¼ ì €ì¥í•˜ëŠ” ì¤‘...')
    
    # plt.tight_layout(): ê·¸ë˜í”„ ìš”ì†Œë“¤ì„ ìë™ìœ¼ë¡œ ì •ë ¬
    plt.tight_layout()
    
    # plt.savefig(): ê·¸ë˜í”„ë¥¼ íŒŒì¼ë¡œ ì €ì¥
    # dpi=300: í•´ìƒë„ (ë†’ì„ìˆ˜ë¡ ì„ ëª…)
    # bbox_inches='tight': ì—¬ë°±ì„ ìë™ìœ¼ë¡œ ì¡°ì •
    plt.savefig(save_path, dpi=300, bbox_inches='tight')
    
    # plt.show(): ê·¸ë˜í”„ë¥¼ í™”ë©´ì— í‘œì‹œ
    plt.show()
    
    print(f'âœ… ì§€ë„ ì‹œê°í™” ì™„ë£Œ: {save_path}')
    print(f'   ì§€ë„ í¬ê¸°: {max_x} x {max_y}')
    
    # ============================================
    # 8ë‹¨ê³„: êµ¬ì¡°ë¬¼ ìœ„ì¹˜ ì •ë³´ ì¶œë ¥
    # ============================================
    print('\nğŸ“ ì£¼ìš” êµ¬ì¡°ë¬¼ ìœ„ì¹˜:')
    
    # ë‚´ ì§‘ ìœ„ì¹˜
    myhome = data[(data['struct_name'] == 'MyHome') & (data['category'] != 0)]
    if len(myhome) > 0:
        for _, row in myhome.iterrows():
            print(f'   ë‚´ ì§‘: ({row["x"]}, {row["y"]})')
    else:
        print('   ë‚´ ì§‘: area 1ì— ì—†ìŠµë‹ˆë‹¤.')
    
    # ë°˜ë‹¬ê³° ì»¤í”¼ ìœ„ì¹˜
    coffee = data[(data['struct_name'] == 'BandalgomCoffee') & (data['category'] != 0)]
    if len(coffee) > 0:
        for _, row in coffee.iterrows():
            print(f'   ë°˜ë‹¬ê³° ì»¤í”¼: ({row["x"]}, {row["y"]})')
    else:
        print('   ë°˜ë‹¬ê³° ì»¤í”¼: area 1ì— ì—†ìŠµë‹ˆë‹¤.')
    
    # ê±´ì„¤ í˜„ì¥ ê°œìˆ˜
    construction_count = len(construction_sites)
    print(f'   ê±´ì„¤ í˜„ì¥: {construction_count}ê°œ')


def main() -> None:
    print('2ë‹¨ê³„: ì§€ë„ ì‹œê°í™” ì‹œì‘\n')
    print('ì´ í”„ë¡œê·¸ë¨ì€ ë¶„ì„ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§€ë„ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.')
    print('=' * 60)
    # ì „ì²´ ë°ì´í„° ì‹œê°í™”
    all_data = load_analyzed_data('all_area_analyzed_data.csv')
    if all_data is not None:
        print(f'âœ… ì „ì²´ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(all_data)}í–‰')
        create_map_visualization(all_data, 'map_all.png')
        print('   - map_all.png íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.')
    else:
        print('âŒ ì „ì²´ ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
    # area 1 ë°ì´í„° ì‹œê°í™”
    area1_data = load_analyzed_data('area1_analyzed_data.csv')
    if area1_data is not None:
        print(f'âœ… area 1 ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(area1_data)}í–‰')
        create_map_visualization(area1_data, 'map_area1.png')
        print('   - map_area1.png íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.')
    else:
        print('âŒ area 1 ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')


# ============================================
# í”„ë¡œê·¸ë¨ ì‹¤í–‰
# ============================================
if __name__ == '__main__':
    # ì´ íŒŒì¼ì´ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ main() í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
    # ë‹¤ë¥¸ íŒŒì¼ì—ì„œ importí•  ë•ŒëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
    main() 