#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸš¶ 3ë‹¨ê³„: ìµœë‹¨ ê²½ë¡œ íƒìƒ‰
===========================================

ì´ íŒŒì¼ì€ ë‚´ ì§‘ì—ì„œ ë°˜ë‹¬ê³° ì»¤í”¼ê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œë¥¼ ì°¾ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.  

ğŸ“ ì…ë ¥:
- 1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ ë¶„ì„ ë°ì´í„° (ì „ì²´ ë°ì´í„°)

ğŸ“Š ì¶œë ¥:
- home_to_cafe.csv: ê²½ë¡œ ë°ì´í„°
- map_final.png: ê²½ë¡œê°€ í‘œì‹œëœ ì§€ë„

ğŸ” ì•Œê³ ë¦¬ì¦˜:
- BFS (Breadth-First Search): ë„ˆë¹„ ìš°ì„  íƒìƒ‰
- 8ë°©í–¥ ì´ë™ (ìƒí•˜ì¢Œìš° + ëŒ€ê°ì„ )
- ê±´ì„¤ í˜„ì¥ê³¼ ì•„íŒŒíŠ¸/ë¹Œë”©ì€ ì¥ì• ë¬¼ë¡œ ì²˜ë¦¬

ğŸ¯ ëª©í‘œ:
- ë‚´ ì§‘(ì‹œì‘ì )ì—ì„œ ë°˜ë‹¬ê³° ì»¤í”¼(ë„ì°©ì )ê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œ ì°¾ê¸°
- ê²½ë¡œë¥¼ CSV íŒŒì¼ë¡œ ì €ì¥
- ê²½ë¡œê°€ í‘œì‹œëœ ì§€ë„ë¥¼ PNG íŒŒì¼ë¡œ ì €ì¥

ì‘ì„±ì: AI Assistant
ë‚ ì§œ: 2024ë…„
"""

import pandas as pd  # ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
import matplotlib.pyplot as plt  # ê·¸ë˜í”„ ê·¸ë¦¬ê¸°ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
plt.rcParams['font.family'] = 'AppleGothic'  # í•œê¸€ í°íŠ¸ ì„¤ì • (Mac)
plt.rcParams['axes.unicode_minus'] = False   # ë§ˆì´ë„ˆìŠ¤ ê¹¨ì§ ë°©ì§€
from collections import deque  # í ìë£Œêµ¬ì¡°ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
from typing import Optional, List, Tuple  # íƒ€ì… íŒíŠ¸ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬


def load_analyzed_data() -> Optional[pd.DataFrame]:  # type: ignore
    """
    ë¶„ì„ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ (ì „ì²´ ë°ì´í„°)
    
    ì´ í•¨ìˆ˜ëŠ” ì „ì²´ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤ (area ì œí•œ ì—†ìŒ).
    ë‚´ ì§‘ì´ area 2ì— ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì „ì²´ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.
    
    Returns:
        Optional[pd.DataFrame]: ë¶„ì„ëœ ë°ì´í„°í”„ë ˆì„, ì‹¤íŒ¨ì‹œ None
    """
    try:
        print('ğŸ“‚ ì „ì²´ ë°ì´í„° ë¶„ì„ì„ ì‹¤í–‰í•©ë‹ˆë‹¤...')
        print('   ë‚´ ì§‘ê³¼ ë°˜ë‹¬ê³° ì»¤í”¼ê°€ ì„œë¡œ ë‹¤ë¥¸ areaì— ìˆì„ ìˆ˜ ìˆì–´ì„œ ì „ì²´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.')
        
        # ============================================
        # 1ë‹¨ê³„: 1ë‹¨ê³„ ë¶„ì„ ëª¨ë“ˆ ì„í¬íŠ¸ ë° ì‹¤í–‰
        # ============================================
        # 1ë‹¨ê³„ ë¶„ì„ ëª¨ë“ˆ ì„í¬íŠ¸ ë° ì‹¤í–‰
        import sys
        import os
        # ìƒìœ„ ë””ë ‰í† ë¦¬ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
        sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
        from coffee_pathfinding_project.caffee_map_detailed import load_and_analyze_data
        area1_data = load_and_analyze_data()
        if area1_data is None:
            return None
        
        # ============================================
        # 2ë‹¨ê³„: ì „ì²´ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¡œë“œ (area ì œí•œ ì—†ìŒ)
        # ============================================
        print('   ì „ì²´ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...')
        
        # CSV íŒŒì¼ë“¤ ë¶ˆëŸ¬ì˜¤ê¸°
        area_map = pd.read_csv('dataFile/area_map.csv')
        area_struct = pd.read_csv('dataFile/area_struct.csv')
        area_category = pd.read_csv('dataFile/area_category.csv')
        
        # ì»¬ëŸ¼ëª…ì˜ ê³µë°± ì œê±°
        area_category.columns = area_category.columns.str.strip()
        
        # êµ¬ì¡°ë¬¼ IDë¥¼ ì´ë¦„ìœ¼ë¡œ ë³€í™˜ (ê³µë°± ì œê±°)
        category_mapping = dict(zip(area_category['category'], area_category['struct'].str.strip()))
        # pandas Seriesì˜ map í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ categoryë¥¼ struct_nameìœ¼ë¡œ ë³€í™˜
        # type: ignore ì£¼ì„ìœ¼ë¡œ íƒ€ì… íŒíŠ¸ ì˜¤ë¥˜ ë¬´ì‹œ
        area_struct['struct_name'] = area_struct['category'].map(category_mapping)  # type: ignore
        
        # ë°ì´í„° ë³‘í•©
        merged_data = pd.merge(area_struct, area_map, on=['x', 'y'], how='left')
        merged_data = merged_data.sort_values(['area', 'x', 'y'])
        
        print(f'âœ… ì „ì²´ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(merged_data)}í–‰')
        return merged_data
        
    except Exception as e:
        print(f'âŒ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: {e}')
        return None


def create_grid(data: pd.DataFrame) -> Tuple[List[List[int]], int, int]:
    """
    2D ê²©ìë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    
    ì´ í•¨ìˆ˜ëŠ” ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ 2ì°¨ì› ê²©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    ê²©ìëŠ” ê²½ë¡œ íƒìƒ‰ì—ì„œ ì¥ì• ë¬¼ì„ íŒë‹¨í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
    
    ê²©ì ê°’ì˜ ì˜ë¯¸:
    - 0: ë¹ˆ ê³µê°„ (ì´ë™ ê°€ëŠ¥)
    - 1: ê±´ì„¤ í˜„ì¥ (ì´ë™ ë¶ˆê°€)
    - 2: ì•„íŒŒíŠ¸/ë¹Œë”© (ì´ë™ ë¶ˆê°€)
    
    Args:
        data: pd.DataFrame - ë¶„ì„ëœ ë°ì´í„°
        
    Returns:
        Tuple[List[List[int]], int, int]: (ê²©ì, ìµœëŒ€ x, ìµœëŒ€ y)
    """
    print('ğŸ—ºï¸ ê²©ìë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...')
    
    # ============================================
    # 1ë‹¨ê³„: ê²©ì í¬ê¸° ê³„ì‚°
    # ============================================
    # ë°ì´í„°ì—ì„œ ê°€ì¥ í° x, y ì¢Œí‘œë¥¼ ì°¾ê¸°
    max_x = int(data['x'].max())
    max_y = int(data['y'].max())
    print(f'   ê²©ì í¬ê¸°: {max_x} x {max_y}')
    
    # ============================================
    # 2ë‹¨ê³„: ë¹ˆ ê²©ì ìƒì„±
    # ============================================
    # ë¦¬ìŠ¤íŠ¸ ì»´í”„ë¦¬í—¨ì…˜ì„ ì‚¬ìš©í•˜ì—¬ 2D ë°°ì—´ ìƒì„±
    # ëª¨ë“  ê°’ì´ 0ì¸ (max_y + 1) x (max_x + 1) í¬ê¸°ì˜ ê²©ì ìƒì„±
    grid = [[0 for _ in range(max_x + 1)] for _ in range(max_y + 1)]
    
    # ============================================
    # 3ë‹¨ê³„: ê±´ì„¤ í˜„ì¥ ë°°ì¹˜ (ìµœê³  ìš°ì„ ìˆœìœ„)
    # ============================================
    # ConstructionSite == 1ì¸ í–‰ë“¤ë§Œ ì„ íƒ
    construction_sites = data[data['ConstructionSite'] == 1]
    for _, row in construction_sites.iterrows():
        grid[row['y'], row['x']] = 1  # ê±´ì„¤ í˜„ì¥ì€ ê°’ 1
    print(f'   ê±´ì„¤ í˜„ì¥ {len(construction_sites)}ê°œ ë°°ì¹˜ ì™„ë£Œ')
    
    # ============================================
    # 4ë‹¨ê³„: êµ¬ì¡°ë¬¼ ë°°ì¹˜ (ì•„íŒŒíŠ¸ì™€ ë¹Œë”©ë§Œ ì¥ì• ë¬¼ë¡œ ì²˜ë¦¬)
    # ============================================
    # categoryê°€ 1(ì•„íŒŒíŠ¸) ë˜ëŠ” 2(ë¹Œë”©)ì´ê³  ê±´ì„¤ í˜„ì¥ì´ ì•„ë‹Œ ê²½ìš°
    structures = data[(data['category'].isin([1, 2])) & (data['ConstructionSite'] == 0)]
    for _, row in structures.iterrows():
        grid[row['y'], row['x']] = 2  # ì•„íŒŒíŠ¸/ë¹Œë”©ì€ ê°’ 2
    print(f'   ì•„íŒŒíŠ¸/ë¹Œë”© {len(structures)}ê°œ ë°°ì¹˜ ì™„ë£Œ')
    
    # ë‚´ ì§‘ê³¼ ë°˜ë‹¬ê³° ì»¤í”¼ëŠ” ì¥ì• ë¬¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ (ì´ë™ ê°€ëŠ¥)
    
    return grid, max_x, max_y


def is_valid_position(pos: Tuple[int, int], grid: List[List[int]]) -> bool:
    """
    ìœ„ì¹˜ê°€ ìœ íš¨í•œì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
    
    ì´ í•¨ìˆ˜ëŠ” ì£¼ì–´ì§„ ìœ„ì¹˜ê°€ ê²©ì ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    
    Args:
        pos: Tuple[int, int] - í™•ì¸í•  ìœ„ì¹˜ (x, y)
        grid: List[List[int]] - ê²©ì
        
    Returns:
        bool: ìœ íš¨í•œ ìœ„ì¹˜ì¸ì§€ ì—¬ë¶€
    """
    x, y = pos
    
    # ê²©ì ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ”ì§€ í™•ì¸
    if x < 0 or y < 0 or y >= len(grid) or x >= len(grid[0]):
        return False
    
    return True


def bfs_pathfinding(start: Tuple[int, int], end: Tuple[int, int], 
                   grid: List[List[int]]) -> Optional[List[Tuple[int, int]]]:
    """
    BFSë¥¼ ì‚¬ìš©í•œ ìµœë‹¨ ê²½ë¡œ íƒìƒ‰
    
    BFS (Breadth-First Search)ëŠ” ì‹œì‘ì ì—ì„œ ê°€ê¹Œìš´ ê³³ë¶€í„° ì°¨ë¡€ëŒ€ë¡œ íƒìƒ‰í•˜ì—¬
    ìµœë‹¨ ê²½ë¡œë¥¼ ì°¾ëŠ” ì•Œê³ ë¦¬ì¦˜ì…ë‹ˆë‹¤.
    
    ì•Œê³ ë¦¬ì¦˜ ë™ì‘ ê³¼ì •:
    1. ì‹œì‘ì ì„ íì— ë„£ê³  ë°©ë¬¸ í‘œì‹œ
    2. íì—ì„œ ìœ„ì¹˜ë¥¼ êº¼ë‚´ì„œ 8ë°©í–¥ìœ¼ë¡œ ì´ë™ ì‹œë„
    3. ìœ íš¨í•˜ê³  ë°©ë¬¸í•˜ì§€ ì•Šì€ ìœ„ì¹˜ë¥¼ íì— ì¶”ê°€
    4. ë„ì°©ì ì— ë„ë‹¬í•˜ë©´ ê²½ë¡œ ë°˜í™˜
    
    Args:
        start: Tuple[int, int] - ì‹œì‘ì  (x, y)
        end: Tuple[int, int] - ë„ì°©ì  (x, y)
        grid: List[List[int]] - ê²©ì
        
    Returns:
        Optional[List[Tuple[int, int]]]: ê²½ë¡œ ì¢Œí‘œ ë¦¬ìŠ¤íŠ¸, ì‹¤íŒ¨ì‹œ None
    """
    print('ğŸ” BFS ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìµœë‹¨ ê²½ë¡œë¥¼ íƒìƒ‰í•˜ëŠ” ì¤‘...')
    
    # ============================================
    # 1ë‹¨ê³„: ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬
    # ============================================
    if not is_valid_position(start, grid) or not is_valid_position(end, grid):
        print("âŒ ì‹œì‘ì  ë˜ëŠ” ë„ì°©ì ì´ ê²©ì ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤.")
        return None
    
    # ============================================
    # 2ë‹¨ê³„: ì‹œì‘ì ì´ë‚˜ ë„ì°©ì ì´ ì¥ì• ë¬¼ì¸ì§€ í™•ì¸
    # ============================================
    if grid[start[1], start[0]] in [1, 2]:  # ê±´ì„¤ í˜„ì¥ì´ë‚˜ ì•„íŒŒíŠ¸/ë¹Œë”©
        print(f"âŒ ì‹œì‘ì  ({start[0]}, {start[1]})ì´ ì¥ì• ë¬¼ì…ë‹ˆë‹¤.")
        return None
    
    if grid[end[1], end[0]] in [1, 2]:  # ê±´ì„¤ í˜„ì¥ì´ë‚˜ ì•„íŒŒíŠ¸/ë¹Œë”©
        print(f"âŒ ë„ì°©ì  ({end[0]}, {end[1]})ì´ ì¥ì• ë¬¼ì…ë‹ˆë‹¤.")
        return None
    
    # ============================================
    # 3ë‹¨ê³„: BFS ì´ˆê¸°í™”
    # ============================================
    # deque(): ì–‘ìª½ ëì—ì„œ ë¹ ë¥´ê²Œ ì¶”ê°€/ì œê±° ê°€ëŠ¥í•œ í
    # (í˜„ì¬ìœ„ì¹˜, ì§€ê¸ˆê¹Œì§€ì˜ê²½ë¡œ) í˜•íƒœë¡œ ì €ì¥
    queue = deque([(start, [start])])
    
    # visited: ì´ë¯¸ ë°©ë¬¸í•œ ìœ„ì¹˜ë“¤ì„ ì €ì¥í•˜ëŠ” ì§‘í•©
    # set(): ì¤‘ë³µì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ìë£Œêµ¬ì¡°
    visited = set([start])
    
    # ============================================
    # 4ë‹¨ê³„: 8ë°©í–¥ ì´ë™ ì •ì˜ (ìƒí•˜ì¢Œìš° + ëŒ€ê°ì„ )
    # ============================================
    directions = [
        (-1, -1), (-1, 0), (-1, 1),  # ì™¼ìª½ ìœ„, ìœ„, ì˜¤ë¥¸ìª½ ìœ„
        (0, -1), (0, 1),             # ì™¼ìª½, ì˜¤ë¥¸ìª½
        (1, -1), (1, 0), (1, 1)      # ì™¼ìª½ ì•„ë˜, ì•„ë˜, ì˜¤ë¥¸ìª½ ì•„ë˜
    ]
    
    # ============================================
    # 5ë‹¨ê³„: BFS ë©”ì¸ ë£¨í”„
    # ============================================
    step_count = 0  # íƒìƒ‰ ë‹¨ê³„ ìˆ˜ ì¹´ìš´íŠ¸
    while queue:  # íì— ìœ„ì¹˜ê°€ ë‚¨ì•„ìˆëŠ” ë™ì•ˆ
        step_count += 1
        if step_count % 1000 == 0:  # 1000ë‹¨ê³„ë§ˆë‹¤ ì§„í–‰ìƒí™© ì¶œë ¥
            print(f"   íƒìƒ‰ ì¤‘... {step_count}ë‹¨ê³„ ì™„ë£Œ")
        
        # íì—ì„œ ê°€ì¥ ë¨¼ì € ë“¤ì–´ì˜¨ ìœ„ì¹˜ êº¼ë‚´ê¸°
        current, path = queue.popleft()
        
        # ë„ì°©ì ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸
        if current == end:
            print(f"âœ… BFSë¡œ ê²½ë¡œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤! ê¸¸ì´: {len(path)} ë‹¨ê³„")
            print(f"   ì´ íƒìƒ‰ ë‹¨ê³„: {step_count}")
            return path
        
        # ============================================
        # 6ë‹¨ê³„: 8ë°©í–¥ìœ¼ë¡œ ì´ë™ ì‹œë„
        # ============================================
        for dx, dy in directions:
            # ë‹¤ìŒ ìœ„ì¹˜ ê³„ì‚°
            next_x = current[0] + dx
            next_y = current[1] + dy
            next_pos = (next_x, next_y)
            
            # ë‹¤ìŒ ìœ„ì¹˜ê°€ ìœ íš¨í•˜ê³  ë°©ë¬¸í•˜ì§€ ì•Šì•˜ê³  ì¥ì• ë¬¼ì´ ì•„ë‹ˆë©´
            if (next_pos not in visited and 
                is_valid_position(next_pos, grid) and 
                grid[next_y, next_x] not in [1, 2]):  # ê±´ì„¤ í˜„ì¥ì´ë‚˜ ì•„íŒŒíŠ¸/ë¹Œë”©ì´ ì•„ë‹ˆë©´
                
                # ë°©ë¬¸ í‘œì‹œ
                visited.add(next_pos)
                
                # íì— ì¶”ê°€ (ê²½ë¡œì— í˜„ì¬ ìœ„ì¹˜ ì¶”ê°€)
                queue.append((next_pos, path + [next_pos]))
    
    # ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°
    print("âŒ BFSë¡œ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    print(f"   ì´ íƒìƒ‰ ë‹¨ê³„: {step_count}")
    return None


def save_path_to_csv(path: Optional[List[Tuple[int, int]]], 
                    filename: str = 'home_to_cafe.csv') -> None:
    """
    ê²½ë¡œë¥¼ CSV íŒŒì¼ë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    
    ì´ í•¨ìˆ˜ëŠ” ì°¾ì€ ê²½ë¡œë¥¼ CSV íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
    ê° ë‹¨ê³„ë³„ë¡œ x, y ì¢Œí‘œì™€ ì¢Œí‘œ ë¬¸ìì—´ì„ í¬í•¨í•©ë‹ˆë‹¤.
    
    Args:
        path: Optional[List[Tuple[int, int]]] - ê²½ë¡œ ì¢Œí‘œ ë¦¬ìŠ¤íŠ¸
        filename: str - ì €ì¥í•  íŒŒì¼ëª…
    """
    if path is None:
        print("âŒ ê²½ë¡œê°€ ì—†ì–´ì„œ CSV íŒŒì¼ì„ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return
    
    print('ğŸ’¾ ê²½ë¡œë¥¼ CSV íŒŒì¼ë¡œ ì €ì¥í•˜ëŠ” ì¤‘...')
    
    # ============================================
    # 1ë‹¨ê³„: ê²½ë¡œ ë°ì´í„°ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜
    # ============================================
    path_data = []
    for i, (x, y) in enumerate(path):
        path_data.append({
            'step': i + 1,                    # ë‹¨ê³„ ë²ˆí˜¸ (1ë¶€í„° ì‹œì‘)
            'x': x,                           # x ì¢Œí‘œ
            'y': y,                           # y ì¢Œí‘œ
            'coordinate': f'({x}, {y})'       # ì¢Œí‘œ ë¬¸ìì—´
        })
    
    # DataFrame ìƒì„±
    df = pd.DataFrame(path_data)
    
    # ============================================
    # 2ë‹¨ê³„: CSV íŒŒì¼ë¡œ ì €ì¥
    # ============================================
    # to_csv(): DataFrameì„ CSV íŒŒì¼ë¡œ ì €ì¥
    # index=False: í–‰ ë²ˆí˜¸ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ
    df.to_csv(filename, index=False)
    
    # ============================================
    # 3ë‹¨ê³„: ì €ì¥ ê²°ê³¼ ì¶œë ¥
    # ============================================
    print(f'âœ… ê²½ë¡œê°€ {filename}ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.')
    print(f'   ì´ ë‹¨ê³„ ìˆ˜: {len(path)}')
    print(f'   ì‹œì‘ì : {path[0]}')
    print(f'   ë„ì°©ì : {path[-1]}')


def visualize_path_with_map(data: pd.DataFrame, path: Optional[List[Tuple[int, int]]], 
                           start: Tuple[int, int], end: Tuple[int, int],
                           save_path: str = 'map_final.png') -> None:
    """
    ê²½ë¡œê°€ í¬í•¨ëœ ì§€ë„ë¥¼ ì‹œê°í™”í•˜ëŠ” í•¨ìˆ˜
    
    ì´ í•¨ìˆ˜ëŠ” ê¸°ì¡´ ì§€ë„ì— ì°¾ì€ ê²½ë¡œë¥¼ ë¹¨ê°„ ì„ ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
    
    Args:
        data: pd.DataFrame - ë¶„ì„ëœ ë°ì´í„°
        path: Optional[List[Tuple[int, int]]] - ê²½ë¡œ ì¢Œí‘œ ë¦¬ìŠ¤íŠ¸
        start: Tuple[int, int] - ì‹œì‘ì 
        end: Tuple[int, int] - ë„ì°©ì 
        save_path: str - ì €ì¥í•  íŒŒì¼ ê²½ë¡œ
    """
    print('ğŸ¨ ê²½ë¡œê°€ í¬í•¨ëœ ì§€ë„ë¥¼ ì‹œê°í™”í•˜ëŠ” ì¤‘...')
    
    # ============================================
    # 1ë‹¨ê³„: ì‹œê°í™” ì„¤ì • ì •ì˜
    # ============================================
    visual_config = {
        'Apartment': {
            'color': 'brown',
            'marker': 'o',
            'size': 100,
            'label': 'ì•„íŒŒíŠ¸/ë¹Œë”©'
        },
        'Building': {
            'color': 'brown',
            'marker': 'o',
            'size': 100,
            'label': 'ì•„íŒŒíŠ¸/ë¹Œë”©'
        },
        'BandalgomCoffee': {
            'color': 'green',
            'marker': 's',
            'size': 120,
            'label': 'ë°˜ë‹¬ê³° ì»¤í”¼'
        },
        'MyHome': {
            'color': 'green',
            'marker': '^',
            'size': 150,
            'label': 'ë‚´ ì§‘'
        }
    }
    
    # ============================================
    # 2ë‹¨ê³„: ê·¸ë˜í”„ ì°½ ìƒì„±
    # ============================================
    plt.figure(figsize=(12, 10))
    
    # ============================================
    # 3ë‹¨ê³„: ê²©ì ê·¸ë¦¬ê¸°
    # ============================================
    plt.grid(True, alpha=0.3, color='gray')
    
    # ============================================
    # 4ë‹¨ê³„: ê±´ì„¤ í˜„ì¥ ë¨¼ì € ê·¸ë¦¬ê¸°
    # ============================================
    construction_sites = data[data['ConstructionSite'] == 1]
    if len(construction_sites) > 0:
        plt.scatter(
            construction_sites['x'],
            construction_sites['y'],
            c='gray',
            marker='s',
            s=80,
            label='ê±´ì„¤ í˜„ì¥',
            alpha=0.7,
            edgecolors='black',
            linewidth=1
        )
    
    # ============================================
    # 5ë‹¨ê³„: êµ¬ì¡°ë¬¼ë³„ë¡œ ì‹œê°í™”í•˜ê¸°
    # ============================================
    for struct_type in ['Apartment', 'Building', 'BandalgomCoffee', 'MyHome']:
        type_data = data[(data['struct_name'] == struct_type) & (data['category'] != 0)]
        
        if len(type_data) > 0:
            config = visual_config[struct_type]
            
            plt.scatter(
                type_data['x'],
                type_data['y'],
                c=config['color'],
                marker=config['marker'],
                s=config['size'],
                label=config['label'],
                alpha=0.8,
                edgecolors='black',
                linewidth=1.5
            )
    
    # ============================================
    # 6ë‹¨ê³„: ê²½ë¡œ ê·¸ë¦¬ê¸° (ë¹¨ê°„ ì„ )
    # ============================================
    if path is not None and len(path) > 1:
        # ê²½ë¡œì˜ x, y ì¢Œí‘œë¥¼ ë¶„ë¦¬
        path_x = [pos[0] for pos in path]
        path_y = [pos[1] for pos in path]
        
        # ê²½ë¡œë¥¼ ë¹¨ê°„ ì„ ìœ¼ë¡œ ê·¸ë¦¬ê¸°
        plt.plot(
            path_x, path_y,
            color='red',
            linewidth=3,
            alpha=0.8,
            label=f'ìµœë‹¨ ê²½ë¡œ ({len(path)}ë‹¨ê³„)',
            marker='o',
            markersize=4
        )
        
        # ============================================
        # 6-1. ì‹œì‘ì ê³¼ ë„ì°©ì  ê°•ì¡°
        # ============================================
        # ì‹œì‘ì  ê°•ì¡°
        plt.scatter(
            [start[0]], [start[1]],
            c='red',
            marker='*',
            s=200,
            label='ì‹œì‘ì  (ë‚´ ì§‘)',
            edgecolors='black',
            linewidth=2
        )
        
        # ë„ì°©ì  ê°•ì¡°
        plt.scatter(
            [end[0]], [end[1]],
            c='red',
            marker='*',
            s=200,
            label='ë„ì°©ì  (ë°˜ë‹¬ê³° ì»¤í”¼)',
            edgecolors='black',
            linewidth=2
        )
    
    # ============================================
    # 7ë‹¨ê³„: ê·¸ë˜í”„ ê¾¸ë¯¸ê¸°
    # ============================================
    max_x = data['x'].max()
    max_y = data['y'].max()
    
    # yì¶•ì„ ë’¤ì§‘ì–´ì„œ ì¢Œì¸¡ ìƒë‹¨ì´ (1,1)ì´ ë˜ë„ë¡ ì„¤ì •
    plt.xlim(0, max_x + 1)
    plt.ylim(max_y + 1, 0)
    
    plt.xlabel('X ì¢Œí‘œ')
    plt.ylabel('Y ì¢Œí‘œ')
    plt.title('ë‚´ ì§‘ì—ì„œ ë°˜ë‹¬ê³° ì»¤í”¼ê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œ', fontsize=16, fontweight='bold')
    plt.legend(loc='upper right', fontsize=10)
    
    # ê²©ì ë²ˆí˜¸ í‘œì‹œ
    plt.xticks(range(1, max_x + 1, 2))
    plt.yticks(range(1, max_y + 1, 2))
    
    # ============================================
    # 8ë‹¨ê³„: ê·¸ë˜í”„ ì €ì¥ ë° í‘œì‹œ
    # ============================================
    plt.tight_layout()
    plt.savefig(save_path, dpi=300, bbox_inches='tight')
    plt.show()
    
    print(f'âœ… ê²½ë¡œ ì‹œê°í™” ì™„ë£Œ: {save_path}')


def main() -> None:
    """
    ë©”ì¸ í•¨ìˆ˜ - í”„ë¡œê·¸ë¨ì˜ ì‹œì‘ì 
    
    ì´ í•¨ìˆ˜ëŠ” ì „ì²´ í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ íë¦„ì„ ê´€ë¦¬í•©ë‹ˆë‹¤:
    1. ë¶„ì„ëœ ë°ì´í„° ë¡œë“œ
    2. ê²©ì ìƒì„±
    3. ì‹œì‘ì ê³¼ ë„ì°©ì  ì°¾ê¸°
    4. ìµœë‹¨ ê²½ë¡œ íƒìƒ‰
    5. ê²½ë¡œ ì €ì¥ ë° ì‹œê°í™”
    """
    print('3ë‹¨ê³„: ìµœë‹¨ ê²½ë¡œ íƒìƒ‰ ì‹œì‘\n')
    print('ì´ í”„ë¡œê·¸ë¨ì€ ë‚´ ì§‘ì—ì„œ ë°˜ë‹¬ê³° ì»¤í”¼ê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œë¥¼ ì°¾ìŠµë‹ˆë‹¤.')
    print('=' * 60)
    
    # ============================================
    # 1ë‹¨ê³„: ë¶„ì„ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    # ============================================
    data = pd.read_csv('../area1_analyzed_data.csv')
    
    if data is None:
        print('âŒ ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        return
    
    print(f'âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(data)}í–‰')
    
    # ============================================
    # 2ë‹¨ê³„: ê²©ì ìƒì„±
    # ============================================
    print('\nğŸ—º ê²©ì ìƒì„± ì¤‘...')
    grid, max_x, max_y = create_grid(data)
    print(f'   ê²©ì í¬ê¸°: {max_x} x {max_y}')
    
    # ============================================
    # 3ë‹¨ê³„: ì‹œì‘ì ê³¼ ë„ì°©ì  ì°¾ê¸°
    # ============================================
    print('\nğŸ“ ì‹œì‘ì ê³¼ ë„ì°©ì  ì°¾ëŠ” ì¤‘...')
    
    # ë‚´ ì§‘ ìœ„ì¹˜ ì°¾ê¸° (ì „ì²´ ë°ì´í„°ì—ì„œ)
    myhome = data[(data['struct_name'] == 'MyHome') & (data['category'] != 0)]
    if len(myhome) == 0:
        print('âŒ ë‚´ ì§‘ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
        return
    
    start = (myhome.iloc[0]['x'], myhome.iloc[0]['y'])
    start_area = myhome.iloc[0]['area']
    print(f'   ë‚´ ì§‘ (ì‹œì‘ì ): {start} (area {start_area})')
    
    # ë°˜ë‹¬ê³° ì»¤í”¼ ìœ„ì¹˜ ì°¾ê¸° (ì „ì²´ ë°ì´í„°ì—ì„œ)
    coffee = data[(data['struct_name'] == 'BandalgomCoffee') & (data['category'] != 0)]
    if len(coffee) == 0:
        print('âŒ ë°˜ë‹¬ê³° ì»¤í”¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
        return
    
    end = (coffee.iloc[0]['x'], coffee.iloc[0]['y'])
    end_area = coffee.iloc[0]['area']
    print(f'   ë°˜ë‹¬ê³° ì»¤í”¼ (ë„ì°©ì ): {end} (area {end_area})')
    
    # ============================================
    # 4ë‹¨ê³„: ìµœë‹¨ ê²½ë¡œ íƒìƒ‰ (BFS)
    # ============================================
    print('\nğŸ” ìµœë‹¨ ê²½ë¡œ íƒìƒ‰ ì¤‘...')
    path = bfs_pathfinding(start, end, grid)
    
    if path is None:
        print('âŒ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')
        return
    
    # ============================================
    # 5ë‹¨ê³„: ê²½ë¡œë¥¼ CSV íŒŒì¼ë¡œ ì €ì¥
    # ============================================
    print('\nğŸ’¾ ê²½ë¡œ ì €ì¥ ì¤‘...')
    save_path_to_csv(path, 'home_to_cafe.csv')
    
    # ============================================
    # 6ë‹¨ê³„: ê²½ë¡œê°€ í¬í•¨ëœ ì§€ë„ ì‹œê°í™”
    # ============================================
    print('\nğŸ¨ ê²½ë¡œ ì‹œê°í™” ì¤‘...')
    visualize_path_with_map(data, path, start, end, 'map_final.png')
    
    # ============================================
    # 7ë‹¨ê³„: ì™„ë£Œ ë©”ì‹œì§€
    # ============================================
    print('\nğŸ‰ ìµœë‹¨ ê²½ë¡œ íƒìƒ‰ ì™„ë£Œ!')
    print('   - home_to_cafe.csv: ê²½ë¡œ ë°ì´í„°')
    print('   - map_final.png: ê²½ë¡œê°€ í‘œì‹œëœ ì§€ë„')
    print(f'   - ì´ {len(path)}ë‹¨ê³„ë¡œ ë„ì°©')
    print('   - BFS ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ì—¬ ìµœë‹¨ ê²½ë¡œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.')


# ============================================
# í”„ë¡œê·¸ë¨ ì‹¤í–‰
# ============================================
if __name__ == '__main__':
    # ì´ íŒŒì¼ì´ ì§ì ‘ ì‹¤í–‰ë  ë•Œë§Œ main() í•¨ìˆ˜ë¥¼ í˜¸ì¶œ
    # ë‹¤ë¥¸ íŒŒì¼ì—ì„œ importí•  ë•ŒëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
    main() 